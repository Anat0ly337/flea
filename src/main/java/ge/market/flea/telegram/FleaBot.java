package ge.market.flea.telegram;import static org.telegram.abilitybots.api.objects.Locality.USER;import static org.telegram.abilitybots.api.objects.Privacy.PUBLIC;import static org.telegram.abilitybots.api.util.AbilityUtils.getChatId;import java.util.List;import java.util.Map;import java.util.function.BiConsumer;import org.springframework.core.env.Environment;import org.springframework.stereotype.Component;import org.telegram.abilitybots.api.bot.AbilityBot;import org.telegram.abilitybots.api.bot.BaseAbilityBot;import org.telegram.abilitybots.api.objects.Ability;import org.telegram.abilitybots.api.objects.Flag;import org.telegram.abilitybots.api.objects.Reply;import org.telegram.telegrambots.meta.api.objects.Update;@Componentpublic class FleaBot extends AbilityBot {    private final InitialResponseHandler initialResponseHandler;    private final MessageReceiver messageReceiver;    public FleaBot(Environment environment) {        super(environment.getProperty("bot.token"), environment.getProperty("bot.name"));        Map<Long, UserState> chatStates = db.getMap("chatStates");        initialResponseHandler = new InitialResponseHandler(silent, chatStates);        messageReceiver = new MessageReceiver(silent, db);    }    public Ability startBot() {        return Ability            .builder()            .name("start")            .info("info")            .locality(USER)            .privacy(PUBLIC)            .action(ctx -> initialResponseHandler.replyToStart(ctx.chatId()))            .build();    }    public Reply replyToButtons() {        BiConsumer<BaseAbilityBot, Update> action = (abilityBot, upd) -> initialResponseHandler.replyToButtons(getChatId(upd), upd.getMessage());        return Reply.of(action, Flag.TEXT, upd -> initialResponseHandler.userIsActive(getChatId(upd)));    }    @Override    public long creatorId() {        return 1L;    }    @Override    public void onUpdatesReceived(List<Update> updates) {        messageReceiver.receiveMessage(updates);        super.onUpdatesReceived(updates);    }}